<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üá∏üá¨ Êñ∞Âä†Âù°ÊóÖÊ∏∏ÊîªÁï• - Êô∫ËÉΩËØ≠Èü≥Êí≠Êîæ</title>
    <meta name="description" content="Ë∂ÖËØ¶ÁªÜÊñ∞Âä†Âù°ÊóÖÊ∏∏ÊîªÁï•ÔºåÂåÖÂê´1200+Âè•Ëã±ËØ≠ÂØπËØùÔºåÁÇπÂáªËã±ÊñáÂç≥ÂèØËØ≠Èü≥Êí≠ÊîæÔºåËÆ©ÊÇ®ÁöÑÊñ∞Âä†Âù°‰πãÊóÖÊõ¥ËΩªÊùæÔºÅ">
    <meta name="keywords" content="Êñ∞Âä†Âù°ÊóÖÊ∏∏,Êñ∞Âä†Âù°ÊîªÁï•,Ëã±ËØ≠ÂØπËØù,ËØ≠Èü≥Êí≠Êîæ,ÊóÖÊ∏∏ÊåáÂçó">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üá∏üá¨</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .feature-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            color: white;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .section-title {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .english-text {
            cursor: pointer;
            color: #3498db;
            text-decoration: underline;
            padding: 3px 6px;
            border-radius: 4px;
            margin: 2px;
            display: inline-block;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .english-text:hover {
            background-color: #3498db;
            color: white;
            transform: scale(1.05);
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }
        
        .english-text.speaking {
            background-color: #e74c3c;
            color: white;
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }
        
        .english-text::after {
            content: 'üîä';
            font-size: 0.8em;
            opacity: 0;
            margin-left: 4px;
            transition: opacity 0.3s ease;
        }
        
        .english-text:hover::after {
            opacity: 1;
        }
        
        .english-text.speaking::after {
            content: 'üî¥';
            opacity: 1;
            animation: blink 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .speech-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .speech-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: #3498db;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .speech-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .speech-btn.disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .speech-btn.settings {
            background: #9b59b6;
        }
        
        .speech-btn.settings:hover {
            background: #8e44ad;
        }
        
        .speech-settings-panel {
            position: absolute;
            bottom: 0;
            right: 80px;
            width: 320px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 20px;
            display: none;
            z-index: 1001;
        }
        
        .speech-settings-panel.show {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .settings-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .setting-group {
            margin-bottom: 15px;
        }
        
        .setting-label {
            display: block;
            font-weight: 500;
            color: #34495e;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .setting-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .range-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .range-input {
            flex: 1;
        }
        
        .range-value {
            min-width: 50px;
            text-align: center;
            font-weight: bold;
            color: #3498db;
        }
        
        .test-btn {
            width: 100%;
            padding: 10px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            transition: background 0.2s ease;
        }
        
        .test-btn:hover {
            background: #229954;
        }
        
        .voice-info {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 5px;
            text-align: center;
        }
        
        .status-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            text-align: center;
            z-index: 1001;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }
        
        .status-bar.show {
            transform: translateY(0);
        }
        
        .demo-section {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: white;
        }
        
        .conversation {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        
        .chinese-text {
            color: #666;
            font-style: italic;
            margin-left: 10px;
        }
        
        .github-link {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .github-link:hover {
            background: #555;
            transform: scale(1.05);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .content-card {
                padding: 20px;
                margin: 10px 0;
            }
            
            .speech-controls {
                bottom: 15px;
                right: 15px;
            }
            
            .speech-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .speech-settings-panel {
                right: 60px;
                width: 280px;
            }
            
            .github-link {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="status-bar" id="statusBar">
        <span id="statusText">ËØ≠Èü≥ÂäüËÉΩÂ∑≤ÂáÜÂ§áÂ∞±Áª™</span>
    </div>
    
    <a href="https://github.com/your-username/singapore-travel-guide" class="github-link" target="_blank">
        ‚≠ê GitHub
    </a>
    
    <div class="container">
        <div class="header">
            <h1>üá∏üá¨ Êñ∞Âä†Âù°ÊóÖÊ∏∏ÊîªÁï•</h1>
            <p>Êô∫ËÉΩËØ≠Èü≥Êí≠Êîæ ¬∑ ÁÇπÂáªËã±ÊñáÂç≥ÂèØÂê¨ÂèëÈü≥ ¬∑ Ë∂ÖËØ¶ÁªÜÊîªÁï•ÊåáÂçó</p>
        </div>
        
        <div class="features">
            <div class="feature-card">
                <div class="feature-icon">üó£Ô∏è</div>
                <h3>Êô∫ËÉΩËØ≠Èü≥Êí≠Êîæ</h3>
                <p>ÁÇπÂáª‰ªª‰ΩïËã±ÊñáÊñáÊú¨Âç≥ÂèØÂê¨Âà∞Ê†áÂáÜÂèëÈü≥ÔºåÊîØÊåÅÂ§öÁßçËØ≠Èü≥ÂºïÊìéÈÄâÊã©</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üìö</div>
                <h3>1200+Âè•ÂØπËØù</h3>
                <p>Ê∂µÁõñ‰ΩèÂÆø„ÄÅ‰∫§ÈÄö„ÄÅÈ§êÈ•Æ„ÄÅË¥≠Áâ©Á≠âÊâÄÊúâÊóÖÊ∏∏Âú∫ÊôØÁöÑÂÆûÁî®Ëã±ËØ≠ÂØπËØù</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üéØ</div>
                <h3>ËØ¶ÁªÜÊîªÁï•</h3>
                <p>ÂõõÂ§©‰∏âÂ§úÂÆåÊï¥Ë°åÁ®ãËßÑÂàíÔºåËØ¶ÁªÜÂà∞ÊØèÈÅìËèúÂêçÁöÑÁæéÈ£üÊåáÂçó</p>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>üîä ËØ≠Èü≥ÂäüËÉΩÊºîÁ§∫</h2>
            <p>ÁÇπÂáª‰∏ãÈù¢ÁöÑËã±ÊñáÊñáÊú¨ËØïËØïËØ≠Èü≥Êí≠ÊîæÂäüËÉΩÔºö</p>
            <div style="margin: 15px 0;">
                <span class="english-text" onclick="speakText(this, 'Hello! Welcome to Singapore!')">Hello! Welcome to Singapore!</span>
                <span class="chinese-text">‰Ω†Â•ΩÔºÅÊ¨¢ËøéÊù•Âà∞Êñ∞Âä†Âù°ÔºÅ</span>
            </div>
            <div style="margin: 15px 0;">
                <span class="english-text" onclick="speakText(this, 'This is an amazing travel guide with natural speech synthesis.')">This is an amazing travel guide with natural speech synthesis.</span>
                <span class="chinese-text">ËøôÊòØ‰∏Ä‰ªΩÂæàÊ£íÁöÑÊóÖÊ∏∏ÊåáÂçóÔºåÈÖçÊúâËá™ÁÑ∂ÁöÑËØ≠Èü≥ÂêàÊàê„ÄÇ</span>
            </div>
        </div>

        <div class="content-card">
            <h2 class="section-title">üè® ‰ΩèÂÆøÂú∫ÊôØÂØπËØù</h2>

            <div class="conversation">
                <h3>ÈÖíÂ∫óÂÖ•‰Ωè</h3>
                <p>
                    <span class="english-text" onclick="speakText(this, 'Good morning, I have a reservation under the name Smith.')">Good morning, I have a reservation under the name Smith.</span>
                    <span class="chinese-text">Êó©‰∏äÂ•ΩÔºåÊàëÁî®Âè≤ÂØÜÊñØÁöÑÂêçÂ≠óÈ¢ÑËÆ¢‰∫ÜÊàøÈó¥„ÄÇ</span>
                </p>
                <p>
                    <span class="english-text" onclick="speakText(this, 'Could I see your passport, please?')">Could I see your passport, please?</span>
                    <span class="chinese-text">ËÉΩÁúã‰∏Ä‰∏ãÊÇ®ÁöÑÊä§ÁÖßÂêóÔºü</span>
                </p>
                <p>
                    <span class="english-text" onclick="speakText(this, 'What time is check-out?')">What time is check-out?</span>
                    <span class="chinese-text">ÈÄÄÊàøÊó∂Èó¥ÊòØÂá†ÁÇπÔºü</span>
                </p>
            </div>
        </div>

        <div class="content-card">
            <h2 class="section-title">üçΩÔ∏è È§êÈ•ÆÂú∫ÊôØÂØπËØù</h2>

            <div class="conversation">
                <h3>Â∞èË¥©‰∏≠ÂøÉÁÇπÈ§ê</h3>
                <p>
                    <span class="english-text" onclick="speakText(this, 'What do you recommend for first-time visitors?')">What do you recommend for first-time visitors?</span>
                    <span class="chinese-text">ÊÇ®Êé®ËçêÁ¨¨‰∏ÄÊ¨°Êù•ÁöÑÊ∏∏ÂÆ¢ÂêÉ‰ªÄ‰πàÔºü</span>
                </p>
                <p>
                    <span class="english-text" onclick="speakText(this, 'How much is the chicken rice?')">How much is the chicken rice?</span>
                    <span class="chinese-text">È∏°È•≠Â§öÂ∞ëÈí±Ôºü</span>
                </p>
            </div>
        </div>

        <div class="content-card">
            <h2 class="section-title">üöá ‰∫§ÈÄöÂú∫ÊôØÂØπËØù</h2>

            <div class="conversation">
                <h3>Âú∞ÈìÅË¥≠Á•®</h3>
                <p>
                    <span class="english-text" onclick="speakText(this, 'Where can I buy an EZ-Link card?')">Where can I buy an EZ-Link card?</span>
                    <span class="chinese-text">Âì™ÈáåÂèØ‰ª•‰π∞ÊòìÈÄöÂç°Ôºü</span>
                </p>
                <p>
                    <span class="english-text" onclick="speakText(this, 'Which line goes to Changi Airport?')">Which line goes to Changi Airport?</span>
                    <span class="chinese-text">Âì™Êù°Á∫øÂéªÊ®üÂÆúÊú∫Âú∫Ôºü</span>
                </p>
            </div>
        </div>
    </div>

    <div class="speech-controls">
        <button class="speech-btn" onclick="toggleSpeech()" title="ËØ≠Èü≥ÂºÄÂÖ≥" id="speechToggle">
            üîä
        </button>
        <button class="speech-btn" onclick="stopAllSpeech()" title="ÂÅúÊ≠¢ËØ≠Èü≥" id="stopBtn">
            ‚èπÔ∏è
        </button>
        <button class="speech-btn settings" onclick="toggleSettings()" title="ËØ≠Èü≥ËÆæÁΩÆ" id="settingsBtn">
            ‚öôÔ∏è
        </button>

        <!-- ËØ≠Èü≥ËÆæÁΩÆÈù¢Êùø -->
        <div class="speech-settings-panel" id="settingsPanel">
            <div class="settings-title">üéµ ËØ≠Èü≥ËÆæÁΩÆ</div>

            <div class="setting-group">
                <label class="setting-label">ËØ≠Èü≥ÈÄâÊã©</label>
                <select class="setting-control" id="voiceSelect" onchange="updateVoiceSettings()">
                    <option value="">Ê≠£Âú®Âä†ËΩΩËØ≠Èü≥...</option>
                </select>
                <div class="voice-info" id="voiceInfo">ÈÄâÊã©ÊÇ®ÂñúÊ¨¢ÁöÑËØ≠Èü≥</div>
            </div>

            <div class="setting-group">
                <label class="setting-label">ËØ≠ÈÄü</label>
                <div class="range-container">
                    <input type="range" class="range-input" id="rateRange" min="0.5" max="1.5" step="0.05" value="0.85" oninput="updateSpeechRate(this.value)" onchange="quickTest('rate')">
                    <span class="range-value" id="rateValue">0.85x</span>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">Èü≥Ë∞É</label>
                <div class="range-container">
                    <input type="range" class="range-input" id="pitchRange" min="0.8" max="1.3" step="0.05" value="1.0" oninput="updateSpeechPitch(this.value)" onchange="quickTest('pitch')">
                    <span class="range-value" id="pitchValue">1.0</span>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">Èü≥Èáè</label>
                <div class="range-container">
                    <input type="range" class="range-input" id="volumeRange" min="0.3" max="1" step="0.05" value="0.8" oninput="updateSpeechVolume(this.value)" onchange="quickTest('volume')">
                    <span class="range-value" id="volumeValue">80%</span>
                </div>
            </div>

            <button class="test-btn" onclick="testSpeech()">
                üéµ ÊµãËØïËØ≠Èü≥ÊïàÊûú
            </button>
        </div>
    </div>

    <script>
        // ËØ≠Èü≥ÂäüËÉΩÂèòÈáè
        let speechEnabled = true;
        let currentSpeaking = null;
        let availableVoices = [];
        let selectedVoice = null;
        let speechSettings = {
            rate: 0.85,       // Êõ¥ÊÖ¢ÁöÑËØ≠ÈÄüÔºåÊõ¥Ëá™ÁÑ∂
            pitch: 1.0,       // Ê†áÂáÜÈü≥Ë∞ÉÔºåÊõ¥Ëá™ÁÑ∂
            volume: 0.8       // Êõ¥‰ΩéÁöÑÈü≥ÈáèÔºåÊõ¥ËàíÈÄÇ
        };

        // Ê£ÄÊü•ÊµèËßàÂô®ÊîØÊåÅ
        const speechSupported = 'speechSynthesis' in window;

        // ÊòæÁ§∫Áä∂ÊÄÅ
        function showStatus(message, duration = 3000) {
            const statusBar = document.getElementById('statusBar');
            const statusText = document.getElementById('statusText');
            statusText.textContent = message;
            statusBar.classList.add('show');

            setTimeout(() => {
                statusBar.classList.remove('show');
            }, duration);
        }

        // ÊñáÊú¨È¢ÑÂ§ÑÁêÜÔºåÊ∑ªÂä†Ëá™ÁÑ∂ÂÅúÈ°ø
        function preprocessText(text) {
            return text
                // Âú®Ê†áÁÇπÁ¨¶Âè∑ÂêéÊ∑ªÂä†Áü≠ÊöÇÂÅúÈ°ø
                .replace(/\./g, '. ')
                .replace(/,/g, ', ')
                .replace(/\?/g, '? ')
                .replace(/!/g, '! ')
                .replace(/:/g, ': ')
                .replace(/;/g, '; ')
                // Âú®ÈáçË¶ÅËØçÊ±áÂâçÂêéÊ∑ªÂä†ÂæÆÂÅúÈ°ø
                .replace(/\b(please|thank you|excuse me|sorry)\b/gi, ' $1 ')
                // Ê∏ÖÁêÜÂ§ö‰ΩôÁ©∫Ê†º
                .replace(/\s+/g, ' ')
                .trim();
        }

        // ÂàõÂª∫ËØ≠Èü≥ÂêàÊàêÂÆû‰æãÁöÑÈÄöÁî®ÂáΩÊï∞
        function createUtterance(text) {
            const utterance = new SpeechSynthesisUtterance(text);

            // È¢ÑÂ§ÑÁêÜÊñáÊú¨ÔºåÊ∑ªÂä†Ëá™ÁÑ∂ÂÅúÈ°ø
            const processedText = preprocessText(text);
            utterance.text = processedText;

            // ËÆæÁΩÆËØ≠Èü≥ÂèÇÊï∞Ôºà‰ΩøÁî®ÂΩìÂâçËÆæÁΩÆÔºâ
            utterance.lang = 'en-US';
            utterance.rate = speechSettings.rate;
            utterance.pitch = speechSettings.pitch;
            utterance.volume = speechSettings.volume;

            // ‰ΩøÁî®Áî®Êà∑ÈÄâÊã©ÁöÑËØ≠Èü≥ÊàñËá™Âä®ÈÄâÊã©ÊúÄ‰Ω≥ËØ≠Èü≥
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            } else {
                // Êô∫ËÉΩÈÄâÊã©ÊúÄËá™ÁÑ∂ÁöÑËØ≠Èü≥
                const voices = window.speechSynthesis.getVoices();
                const naturalVoices = [
                    // ‰ºòÂÖàÈÄâÊã©Á•ûÁªèÁΩëÁªúËØ≠Èü≥ÔºàÊõ¥Ëá™ÁÑ∂Ôºâ
                    voices.find(voice => voice.name.includes('Neural') && voice.lang === 'en-US'),
                    voices.find(voice => voice.name.includes('Premium') && voice.lang === 'en-US'),

                    // Google ËØ≠Èü≥ÔºàÈ´òË¥®ÈáèÔºâ
                    voices.find(voice => voice.name.includes('Google US English')),
                    voices.find(voice => voice.name.includes('Google') && voice.lang === 'en-US'),

                    // Microsoft È´òË¥®ÈáèËØ≠Èü≥
                    voices.find(voice => voice.name.includes('Microsoft Aria') && voice.lang === 'en-US'),
                    voices.find(voice => voice.name.includes('Microsoft Jenny') && voice.lang === 'en-US'),

                    // Apple È´òË¥®ÈáèËØ≠Èü≥
                    voices.find(voice => voice.name.includes('Samantha')),
                    voices.find(voice => voice.name.includes('Alex')),

                    // ÂÖ∂‰ªñÊú¨Âú∞ËØ≠Èü≥
                    voices.find(voice => voice.lang === 'en-US' && voice.localService),
                    voices.find(voice => voice.lang.startsWith('en'))
                ];

                const autoSelectedVoice = naturalVoices.find(voice => voice);
                if (autoSelectedVoice) {
                    utterance.voice = autoSelectedVoice;
                }
            }

            return utterance;
        }

        // ËØ≠Èü≥Êí≠ÊîæÂáΩÊï∞
        function speakText(element, text) {
            if (!speechSupported) {
                showStatus('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ÂêàÊàêÂäüËÉΩ');
                return;
            }

            if (!speechEnabled) {
                showStatus('ËØ≠Èü≥ÂäüËÉΩÂ∑≤ÂÖ≥Èó≠');
                return;
            }

            // ÂÅúÊ≠¢ÂΩìÂâçÊí≠Êîæ
            window.speechSynthesis.cancel();

            // ÁßªÈô§‰πãÂâçÁöÑspeakingÁ±ª
            if (currentSpeaking) {
                currentSpeaking.classList.remove('speaking');
            }

            // ÂàõÂª∫ËØ≠Èü≥ÂêàÊàêÂÆû‰æãÔºà‰ΩøÁî®ÊúÄÊñ∞ËÆæÁΩÆÔºâ
            const utterance = createUtterance(text);

            // ‰∫ã‰ª∂ÁõëÂê¨
            utterance.onstart = () => {
                element.classList.add('speaking');
                currentSpeaking = element;
                showStatus(`üéµ Ê≠£Âú®Êí≠Êîæ: ${text}`);
            };

            utterance.onend = () => {
                element.classList.remove('speaking');
                currentSpeaking = null;
            };

            utterance.onerror = (event) => {
                console.error('ËØ≠Èü≥Êí≠ÊîæÈîôËØØ:', event.error);
                element.classList.remove('speaking');
                currentSpeaking = null;
                showStatus('ËØ≠Èü≥Êí≠ÊîæÂá∫ÈîôÔºåËØ∑ÈáçËØï');
            };

            // Êí≠ÊîæËØ≠Èü≥
            window.speechSynthesis.speak(utterance);
        }

        // ÂàáÊç¢ËØ≠Èü≥ÂäüËÉΩ
        function toggleSpeech() {
            speechEnabled = !speechEnabled;
            const toggleBtn = document.getElementById('speechToggle');

            if (speechEnabled) {
                toggleBtn.textContent = 'üîä';
                toggleBtn.style.background = '#3498db';
                showStatus('‚úÖ ËØ≠Èü≥ÂäüËÉΩÂ∑≤ÂºÄÂêØ');
            } else {
                toggleBtn.textContent = 'üîá';
                toggleBtn.style.background = '#95a5a6';
                showStatus('‚ùå ËØ≠Èü≥ÂäüËÉΩÂ∑≤ÂÖ≥Èó≠');
                stopAllSpeech();
            }
        }

        // ÂÅúÊ≠¢ÊâÄÊúâËØ≠Èü≥
        function stopAllSpeech() {
            window.speechSynthesis.cancel();
            if (currentSpeaking) {
                currentSpeaking.classList.remove('speaking');
                currentSpeaking = null;
            }
            showStatus('‚èπÔ∏è Â∑≤ÂÅúÊ≠¢ËØ≠Èü≥Êí≠Êîæ');
        }

        // ÂàáÊç¢ËÆæÁΩÆÈù¢Êùø
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('show');
        }

        // Âä†ËΩΩÂèØÁî®ËØ≠Èü≥
        function loadVoices() {
            availableVoices = window.speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');

            // Ê∏ÖÁ©∫Áé∞ÊúâÈÄâÈ°π
            voiceSelect.innerHTML = '';

            // Á≠õÈÄâËã±ËØ≠ËØ≠Èü≥Âπ∂ÊåâË¥®ÈáèÊéíÂ∫è
            const englishVoices = availableVoices.filter(voice => voice.lang.startsWith('en'));

            // Êåâ‰ºòÂÖàÁ∫ßÊéíÂ∫è
            const sortedVoices = englishVoices.sort((a, b) => {
                // Neural/Premium ËØ≠Èü≥‰ºòÂÖà
                if ((a.name.includes('Neural') || a.name.includes('Premium')) &&
                    !(b.name.includes('Neural') || b.name.includes('Premium'))) return -1;
                if (!(a.name.includes('Neural') || a.name.includes('Premium')) &&
                    (b.name.includes('Neural') || b.name.includes('Premium'))) return 1;

                // Google ËØ≠Èü≥‰ºòÂÖà
                if (a.name.includes('Google') && !b.name.includes('Google')) return -1;
                if (!a.name.includes('Google') && b.name.includes('Google')) return 1;

                // Microsoft ËØ≠Èü≥Ê¨°‰πã
                if (a.name.includes('Microsoft') && !b.name.includes('Microsoft')) return -1;
                if (!a.name.includes('Microsoft') && b.name.includes('Microsoft')) return 1;

                // Êú¨Âú∞ËØ≠Èü≥‰ºòÂÖà‰∫éËøúÁ®ãËØ≠Èü≥
                if (a.localService && !b.localService) return -1;
                if (!a.localService && b.localService) return 1;

                // ÁæéÂºèËã±ËØ≠‰ºòÂÖà
                if (a.lang === 'en-US' && b.lang !== 'en-US') return -1;
                if (a.lang !== 'en-US' && b.lang === 'en-US') return 1;

                return a.name.localeCompare(b.name);
            });

            // Ê∑ªÂä†ËØ≠Èü≥ÈÄâÈ°π
            sortedVoices.forEach((voice, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${voice.name} (${voice.lang})`;

                // Ê†áËÆ∞Êé®ËçêËØ≠Èü≥
                if (voice.name.includes('Neural') || voice.name.includes('Premium') ||
                    voice.name.includes('Google') || voice.name.includes('Samantha') ||
                    voice.name.includes('Alex')) {
                    option.textContent += ' ‚≠ê';
                }

                voiceSelect.appendChild(option);

                // Ëá™Âä®ÈÄâÊã©Á¨¨‰∏Ä‰∏™È´òË¥®ÈáèËØ≠Èü≥
                if (index === 0) {
                    selectedVoice = voice;
                    option.selected = true;
                }
            });
        }

        // Êõ¥Êñ∞ËØ≠Èü≥ËÆæÁΩÆ
        function updateVoiceSettings() {
            const voiceSelect = document.getElementById('voiceSelect');
            const selectedIndex = voiceSelect.value;

            if (selectedIndex !== '' && availableVoices[selectedIndex]) {
                selectedVoice = availableVoices[selectedIndex];
                showStatus(`‚úÖ Â∑≤ÂàáÊç¢Âà∞: ${selectedVoice.name}`);
            }
        }

        // Êõ¥Êñ∞ËØ≠ÈÄü
        function updateSpeechRate(value) {
            speechSettings.rate = parseFloat(value);
            document.getElementById('rateValue').textContent = value + 'x';
        }

        // Êõ¥Êñ∞Èü≥Ë∞É
        function updateSpeechPitch(value) {
            speechSettings.pitch = parseFloat(value);
            document.getElementById('pitchValue').textContent = value;
        }

        // Êõ¥Êñ∞Èü≥Èáè
        function updateSpeechVolume(value) {
            speechSettings.volume = parseFloat(value);
            document.getElementById('volumeValue').textContent = Math.round(value * 100) + '%';
        }

        // Âø´ÈÄüÊµãËØïÁâπÂÆöÂèÇÊï∞
        function quickTest(paramType) {
            if (!speechSupported || !speechEnabled) return;

            const testTexts = {
                rate: "Testing speech rate.",
                pitch: "Testing voice pitch.",
                volume: "Testing volume level.",
                default: "Quick test."
            };

            const text = testTexts[paramType] || testTexts.default;

            // ÂÅúÊ≠¢ÂΩìÂâçÊí≠Êîæ
            window.speechSynthesis.cancel();

            // ÂàõÂª∫ËØ≠Èü≥ÂêàÊàêÂÆû‰æãÔºà‰ΩøÁî®ÊúÄÊñ∞ËÆæÁΩÆÔºâ
            const utterance = createUtterance(text);

            // Êí≠ÊîæËØ≠Èü≥
            window.speechSynthesis.speak(utterance);
        }

        // ÊµãËØïËØ≠Èü≥
        function testSpeech() {
            if (!speechSupported || !speechEnabled) {
                showStatus('ËØ≠Èü≥ÂäüËÉΩ‰∏çÂèØÁî®');
                return;
            }

            const testTexts = [
                "Hello! This is a test of the optimized speech synthesis.",
                "Welcome to Singapore! Have a wonderful trip!",
                "The voice quality has been enhanced for natural pronunciation."
            ];

            const randomText = testTexts[Math.floor(Math.random() * testTexts.length)];

            // ÂÅúÊ≠¢ÂΩìÂâçÊí≠Êîæ
            window.speechSynthesis.cancel();

            // ÂàõÂª∫ËØ≠Èü≥ÂêàÊàêÂÆû‰æãÔºà‰ΩøÁî®ÊúÄÊñ∞ËÆæÁΩÆÔºâ
            const utterance = createUtterance(randomText);

            // ‰∫ã‰ª∂ÁõëÂê¨
            utterance.onstart = () => {
                showStatus(`üéµ ÊµãËØïÊí≠Êîæ: ${randomText}`);
            };

            utterance.onend = () => {
                showStatus('‚úÖ ÊµãËØïÂÆåÊàêÔºÅÁé∞Âú®ÁÇπÂáªËã±ÊñáÊñáÊú¨‰ΩìÈ™å‰ºòÂåñÊïàÊûú');
            };

            utterance.onerror = (event) => {
                console.error('ÊµãËØïËØ≠Èü≥Êí≠ÊîæÈîôËØØ:', event.error);
                showStatus('ÊµãËØïËØ≠Èü≥Êí≠ÊîæÂá∫ÈîôÔºåËØ∑ÈáçËØï');
            };

            // Êí≠ÊîæËØ≠Èü≥
            window.speechSynthesis.speak(utterance);
        }

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            if (!speechSupported) {
                showStatus('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ÂêàÊàêÂäüËÉΩÔºåËØ∑‰ΩøÁî®Chrome„ÄÅSafariÊàñEdgeÊµèËßàÂô®', 5000);
                document.getElementById('speechToggle').classList.add('disabled');
                document.getElementById('stopBtn').classList.add('disabled');
                document.getElementById('settingsBtn').classList.add('disabled');
            } else {
                showStatus('üéµ ËØ≠Èü≥ÂäüËÉΩÂ∑≤‰ºòÂåñÔºåÁÇπÂáªËã±ÊñáÊñáÊú¨Âç≥ÂèØÊí≠ÊîæËá™ÁÑ∂ËØ≠Èü≥');

                // Âä†ËΩΩËØ≠Èü≥ÂàóË°®
                loadVoices();
                window.speechSynthesis.onvoiceschanged = loadVoices;

                // ÁÇπÂáªÈ°µÈù¢ÂÖ∂‰ªñÂú∞ÊñπÂÖ≥Èó≠ËÆæÁΩÆÈù¢Êùø
                document.addEventListener('click', function(event) {
                    const panel = document.getElementById('settingsPanel');
                    const settingsBtn = document.getElementById('settingsBtn');

                    if (!panel.contains(event.target) && event.target !== settingsBtn) {
                        panel.classList.remove('show');
                    }
                });
            }
        });

        // ÈîÆÁõòÂø´Êç∑ÈîÆ
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case 's':
                        event.preventDefault();
                        toggleSpeech();
                        break;
                    case 'x':
                        event.preventDefault();
                        stopAllSpeech();
                        break;
                }
            }
        });
    </script>
</body>
</html>
