<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡æ—…æ¸¸æ”»ç•¥ - æ™ºèƒ½è¯­éŸ³æ’­æ”¾</title>
    <meta name="description" content="è¶…è¯¦ç»†æ–°åŠ å¡æ—…æ¸¸æ”»ç•¥ï¼ŒåŒ…å«1200+å¥è‹±è¯­å¯¹è¯ï¼Œç‚¹å‡»è‹±æ–‡å³å¯è¯­éŸ³æ’­æ”¾ï¼Œè®©æ‚¨çš„æ–°åŠ å¡ä¹‹æ—…æ›´è½»æ¾ï¼">
    <meta name="keywords" content="æ–°åŠ å¡æ—…æ¸¸,æ–°åŠ å¡æ”»ç•¥,è‹±è¯­å¯¹è¯,è¯­éŸ³æ’­æ”¾,æ—…æ¸¸æŒ‡å—">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ‡¸ğŸ‡¬</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .feature-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            color: white;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .section-title {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .english-text {
            cursor: pointer;
            color: #3498db;
            text-decoration: underline;
            padding: 3px 6px;
            border-radius: 4px;
            margin: 2px;
            display: inline-block;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .english-text:hover {
            background-color: #3498db;
            color: white;
            transform: scale(1.05);
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }
        
        .english-text.speaking {
            background-color: #e74c3c;
            color: white;
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }
        
        .english-text::after {
            content: 'ğŸ”Š';
            font-size: 0.8em;
            opacity: 0;
            margin-left: 4px;
            transition: opacity 0.3s ease;
        }
        
        .english-text:hover::after {
            opacity: 1;
        }
        
        .english-text.speaking::after {
            content: 'ğŸ”´';
            opacity: 1;
            animation: blink 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .speech-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .speech-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: #3498db;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .speech-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .speech-btn.disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .speech-btn.settings {
            background: #9b59b6;
        }
        
        .speech-btn.settings:hover {
            background: #8e44ad;
        }
        
        .speech-settings-panel {
            position: absolute;
            bottom: 0;
            right: 80px;
            width: 320px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 20px;
            display: none;
            z-index: 1001;
        }
        
        .speech-settings-panel.show {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .settings-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .setting-group {
            margin-bottom: 15px;
        }
        
        .setting-label {
            display: block;
            font-weight: 500;
            color: #34495e;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .setting-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .range-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .range-input {
            flex: 1;
        }
        
        .range-value {
            min-width: 50px;
            text-align: center;
            font-weight: bold;
            color: #3498db;
        }
        
        .test-btn {
            width: 100%;
            padding: 10px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            transition: background 0.2s ease;
        }
        
        .test-btn:hover {
            background: #229954;
        }
        
        .voice-info {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 5px;
            text-align: center;
        }
        
        .status-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            text-align: center;
            z-index: 1001;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }
        
        .status-bar.show {
            transform: translateY(0);
        }
        
        .demo-section {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: white;
        }
        
        .conversation {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        
        .chinese-text {
            color: #666;
            font-style: italic;
            margin-left: 10px;
        }
        
        .github-link {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .github-link:hover {
            background: #555;
            transform: scale(1.05);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .content-card {
                padding: 20px;
                margin: 10px 0;
            }
            
            .speech-controls {
                bottom: 15px;
                right: 15px;
            }
            
            .speech-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .speech-settings-panel {
                right: 60px;
                width: 280px;
            }
            
            .github-link {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="status-bar" id="statusBar">
        <span id="statusText">è¯­éŸ³åŠŸèƒ½å·²å‡†å¤‡å°±ç»ª</span>
    </div>
    
    <a href="https://github.com/your-username/singapore-travel-guide" class="github-link" target="_blank">
        â­ GitHub
    </a>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡æ—…æ¸¸æ”»ç•¥</h1>
            <p>æ™ºèƒ½è¯­éŸ³æ’­æ”¾ Â· ç‚¹å‡»è‹±æ–‡å³å¯å¬å‘éŸ³ Â· è¶…è¯¦ç»†æ”»ç•¥æŒ‡å—</p>
        </div>
        
        <div class="features">
            <div class="feature-card">
                <div class="feature-icon">ğŸ—£ï¸</div>
                <h3>æ™ºèƒ½è¯­éŸ³æ’­æ”¾</h3>
                <p>ç‚¹å‡»ä»»ä½•è‹±æ–‡æ–‡æœ¬å³å¯å¬åˆ°æ ‡å‡†å‘éŸ³ï¼Œæ”¯æŒå¤šç§è¯­éŸ³å¼•æ“é€‰æ‹©</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ“š</div>
                <h3>1200+å¥å¯¹è¯</h3>
                <p>æ¶µç›–ä½å®¿ã€äº¤é€šã€é¤é¥®ã€è´­ç‰©ç­‰æ‰€æœ‰æ—…æ¸¸åœºæ™¯çš„å®ç”¨è‹±è¯­å¯¹è¯</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ¯</div>
                <h3>è¯¦ç»†æ”»ç•¥</h3>
                <p>å››å¤©ä¸‰å¤œå®Œæ•´è¡Œç¨‹è§„åˆ’ï¼Œè¯¦ç»†åˆ°æ¯é“èœåçš„ç¾é£ŸæŒ‡å—</p>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>ğŸ”Š è¯­éŸ³åŠŸèƒ½æ¼”ç¤º</h2>
            <p>ç‚¹å‡»ä¸‹é¢çš„è‹±æ–‡æ–‡æœ¬è¯•è¯•è¯­éŸ³æ’­æ”¾åŠŸèƒ½ï¼š</p>
            <div style="margin: 15px 0;">
                <span class="english-text" onclick="speakText(this, 'Hello! Welcome to Singapore!')">Hello! Welcome to Singapore!</span>
                <span class="chinese-text">ä½ å¥½ï¼æ¬¢è¿æ¥åˆ°æ–°åŠ å¡ï¼</span>
            </div>
            <div style="margin: 15px 0;">
                <span class="english-text" onclick="speakText(this, 'This is an amazing travel guide with natural speech synthesis.')">This is an amazing travel guide with natural speech synthesis.</span>
                <span class="chinese-text">è¿™æ˜¯ä¸€ä»½å¾ˆæ£’çš„æ—…æ¸¸æŒ‡å—ï¼Œé…æœ‰è‡ªç„¶çš„è¯­éŸ³åˆæˆã€‚</span>
            </div>
        </div>

        <div class="content-card">
            <h2 class="section-title">ğŸ¨ ä½å®¿åœºæ™¯å¯¹è¯</h2>

            <div class="conversation">
                <h3>é…’åº—å…¥ä½</h3>
                <p>
                    <span class="english-text" onclick="speakText(this, 'Good morning, I have a reservation under the name Smith.')">Good morning, I have a reservation under the name Smith.</span>
                    <span class="chinese-text">æ—©ä¸Šå¥½ï¼Œæˆ‘ç”¨å²å¯†æ–¯çš„åå­—é¢„è®¢äº†æˆ¿é—´ã€‚</span>
                </p>
                <p>
                    <span class="english-text" onclick="speakText(this, 'Could I see your passport, please?')">Could I see your passport, please?</span>
                    <span class="chinese-text">èƒ½çœ‹ä¸€ä¸‹æ‚¨çš„æŠ¤ç…§å—ï¼Ÿ</span>
                </p>
                <p>
                    <span class="english-text" onclick="speakText(this, 'What time is check-out?')">What time is check-out?</span>
                    <span class="chinese-text">é€€æˆ¿æ—¶é—´æ˜¯å‡ ç‚¹ï¼Ÿ</span>
                </p>
            </div>
        </div>

        <div class="content-card">
            <h2 class="section-title">ğŸ½ï¸ é¤é¥®åœºæ™¯å¯¹è¯</h2>

            <div class="conversation">
                <h3>å°è´©ä¸­å¿ƒç‚¹é¤</h3>
                <p>
                    <span class="english-text" onclick="speakText(this, 'What do you recommend for first-time visitors?')">What do you recommend for first-time visitors?</span>
                    <span class="chinese-text">æ‚¨æ¨èç¬¬ä¸€æ¬¡æ¥çš„æ¸¸å®¢åƒä»€ä¹ˆï¼Ÿ</span>
                </p>
                <p>
                    <span class="english-text" onclick="speakText(this, 'How much is the chicken rice?')">How much is the chicken rice?</span>
                    <span class="chinese-text">é¸¡é¥­å¤šå°‘é’±ï¼Ÿ</span>
                </p>
            </div>
        </div>

        <div class="content-card">
            <h2 class="section-title">ğŸš‡ äº¤é€šåœºæ™¯å¯¹è¯</h2>

            <div class="conversation">
                <h3>åœ°é“è´­ç¥¨</h3>
                <p>
                    <span class="english-text" onclick="speakText(this, 'Where can I buy an EZ-Link card?')">Where can I buy an EZ-Link card?</span>
                    <span class="chinese-text">å“ªé‡Œå¯ä»¥ä¹°æ˜“é€šå¡ï¼Ÿ</span>
                </p>
                <p>
                    <span class="english-text" onclick="speakText(this, 'Which line goes to Changi Airport?')">Which line goes to Changi Airport?</span>
                    <span class="chinese-text">å“ªæ¡çº¿å»æ¨Ÿå®œæœºåœºï¼Ÿ</span>
                </p>
            </div>
        </div>
    </div>

    <div class="speech-controls">
        <button class="speech-btn" onclick="toggleSpeech()" title="è¯­éŸ³å¼€å…³" id="speechToggle">
            ğŸ”Š
        </button>
        <button class="speech-btn" onclick="stopAllSpeech()" title="åœæ­¢è¯­éŸ³" id="stopBtn">
            â¹ï¸
        </button>
        <button class="speech-btn settings" onclick="toggleSettings()" title="è¯­éŸ³è®¾ç½®" id="settingsBtn">
            âš™ï¸
        </button>

        <!-- è¯­éŸ³è®¾ç½®é¢æ¿ -->
        <div class="speech-settings-panel" id="settingsPanel">
            <div class="settings-title">ğŸµ è¯­éŸ³è®¾ç½®</div>

            <div class="setting-group">
                <label class="setting-label">è¯­éŸ³é€‰æ‹©</label>
                <select class="setting-control" id="voiceSelect" onchange="updateVoiceSettings()">
                    <option value="">æ­£åœ¨åŠ è½½è¯­éŸ³...</option>
                </select>
                <div class="voice-info" id="voiceInfo">é€‰æ‹©æ‚¨å–œæ¬¢çš„è¯­éŸ³</div>
            </div>

            <div class="setting-group">
                <label class="setting-label">è¯­é€Ÿ</label>
                <div class="range-container">
                    <input type="range" class="range-input" id="rateRange" min="0.5" max="1.5" step="0.05" value="0.85" oninput="updateSpeechRate(this.value)" onchange="quickTest('rate')">
                    <span class="range-value" id="rateValue">0.85x</span>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">éŸ³è°ƒ</label>
                <div class="range-container">
                    <input type="range" class="range-input" id="pitchRange" min="0.8" max="1.3" step="0.05" value="1.0" oninput="updateSpeechPitch(this.value)" onchange="quickTest('pitch')">
                    <span class="range-value" id="pitchValue">1.0</span>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">éŸ³é‡</label>
                <div class="range-container">
                    <input type="range" class="range-input" id="volumeRange" min="0.3" max="1" step="0.05" value="0.8" oninput="updateSpeechVolume(this.value)" onchange="quickTest('volume')">
                    <span class="range-value" id="volumeValue">80%</span>
                </div>
            </div>

            <button class="test-btn" onclick="testSpeech()">
                ğŸµ æµ‹è¯•è¯­éŸ³æ•ˆæœ
            </button>
        </div>
    </div>

    <script>
        // è¯­éŸ³åŠŸèƒ½å˜é‡
        let speechEnabled = true;
        let currentSpeaking = null;
        let availableVoices = [];
        let selectedVoice = null;
        let speechSettings = {
            rate: 0.85,       // æ›´æ…¢çš„è¯­é€Ÿï¼Œæ›´è‡ªç„¶
            pitch: 1.0,       // æ ‡å‡†éŸ³è°ƒï¼Œæ›´è‡ªç„¶
            volume: 0.8       // æ›´ä½çš„éŸ³é‡ï¼Œæ›´èˆ’é€‚
        };

        // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
        const speechSupported = 'speechSynthesis' in window;

        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, duration = 3000) {
            const statusBar = document.getElementById('statusBar');
            const statusText = document.getElementById('statusText');
            statusText.textContent = message;
            statusBar.classList.add('show');

            setTimeout(() => {
                statusBar.classList.remove('show');
            }, duration);
        }

        // æ–‡æœ¬é¢„å¤„ç†ï¼Œæ·»åŠ è‡ªç„¶åœé¡¿
        function preprocessText(text) {
            return text
                // åœ¨æ ‡ç‚¹ç¬¦å·åæ·»åŠ çŸ­æš‚åœé¡¿
                .replace(/\./g, '. ')
                .replace(/,/g, ', ')
                .replace(/\?/g, '? ')
                .replace(/!/g, '! ')
                .replace(/:/g, ': ')
                .replace(/;/g, '; ')
                // åœ¨é‡è¦è¯æ±‡å‰åæ·»åŠ å¾®åœé¡¿
                .replace(/\b(please|thank you|excuse me|sorry)\b/gi, ' $1 ')
                // æ¸…ç†å¤šä½™ç©ºæ ¼
                .replace(/\s+/g, ' ')
                .trim();
        }

        // åˆ›å»ºè¯­éŸ³åˆæˆå®ä¾‹çš„é€šç”¨å‡½æ•°
        function createUtterance(text) {
            const utterance = new SpeechSynthesisUtterance(text);

            // é¢„å¤„ç†æ–‡æœ¬ï¼Œæ·»åŠ è‡ªç„¶åœé¡¿
            const processedText = preprocessText(text);
            utterance.text = processedText;

            // è®¾ç½®è¯­éŸ³å‚æ•°ï¼ˆä½¿ç”¨å½“å‰è®¾ç½®ï¼‰
            utterance.lang = 'en-US';
            utterance.rate = speechSettings.rate;
            utterance.pitch = speechSettings.pitch;
            utterance.volume = speechSettings.volume;

            // ä½¿ç”¨ç”¨æˆ·é€‰æ‹©çš„è¯­éŸ³æˆ–è‡ªåŠ¨é€‰æ‹©æœ€ä½³è¯­éŸ³
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            } else {
                // æ™ºèƒ½é€‰æ‹©æœ€è‡ªç„¶çš„è¯­éŸ³
                const voices = window.speechSynthesis.getVoices();
                const naturalVoices = [
                    // ä¼˜å…ˆé€‰æ‹©ç¥ç»ç½‘ç»œè¯­éŸ³ï¼ˆæ›´è‡ªç„¶ï¼‰
                    voices.find(voice => voice.name.includes('Neural') && voice.lang === 'en-US'),
                    voices.find(voice => voice.name.includes('Premium') && voice.lang === 'en-US'),

                    // Google è¯­éŸ³ï¼ˆé«˜è´¨é‡ï¼‰
                    voices.find(voice => voice.name.includes('Google US English')),
                    voices.find(voice => voice.name.includes('Google') && voice.lang === 'en-US'),

                    // Microsoft é«˜è´¨é‡è¯­éŸ³
                    voices.find(voice => voice.name.includes('Microsoft Aria') && voice.lang === 'en-US'),
                    voices.find(voice => voice.name.includes('Microsoft Jenny') && voice.lang === 'en-US'),

                    // Apple é«˜è´¨é‡è¯­éŸ³
                    voices.find(voice => voice.name.includes('Samantha')),
                    voices.find(voice => voice.name.includes('Alex')),

                    // å…¶ä»–æœ¬åœ°è¯­éŸ³
                    voices.find(voice => voice.lang === 'en-US' && voice.localService),
                    voices.find(voice => voice.lang.startsWith('en'))
                ];

                const autoSelectedVoice = naturalVoices.find(voice => voice);
                if (autoSelectedVoice) {
                    utterance.voice = autoSelectedVoice;
                }
            }

            return utterance;
        }

        // è¯­éŸ³æ’­æ”¾å‡½æ•°
        function speakText(element, text) {
            if (!speechSupported) {
                showStatus('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½');
                return;
            }

            if (!speechEnabled) {
                showStatus('è¯­éŸ³åŠŸèƒ½å·²å…³é—­');
                return;
            }

            // åœæ­¢å½“å‰æ’­æ”¾
            window.speechSynthesis.cancel();

            // ç§»é™¤ä¹‹å‰çš„speakingç±»
            if (currentSpeaking) {
                currentSpeaking.classList.remove('speaking');
            }

            // åˆ›å»ºè¯­éŸ³åˆæˆå®ä¾‹ï¼ˆä½¿ç”¨æœ€æ–°è®¾ç½®ï¼‰
            const utterance = createUtterance(text);

            // äº‹ä»¶ç›‘å¬
            utterance.onstart = () => {
                element.classList.add('speaking');
                currentSpeaking = element;
                showStatus(`ğŸµ æ­£åœ¨æ’­æ”¾: ${text}`);
            };

            utterance.onend = () => {
                element.classList.remove('speaking');
                currentSpeaking = null;
            };

            utterance.onerror = (event) => {
                console.error('è¯­éŸ³æ’­æ”¾é”™è¯¯:', event.error);
                element.classList.remove('speaking');
                currentSpeaking = null;
                showStatus('è¯­éŸ³æ’­æ”¾å‡ºé”™ï¼Œè¯·é‡è¯•');
            };

            // æ’­æ”¾è¯­éŸ³
            window.speechSynthesis.speak(utterance);
        }

        // åˆ‡æ¢è¯­éŸ³åŠŸèƒ½
        function toggleSpeech() {
            speechEnabled = !speechEnabled;
            const toggleBtn = document.getElementById('speechToggle');

            if (speechEnabled) {
                toggleBtn.textContent = 'ğŸ”Š';
                toggleBtn.style.background = '#3498db';
                showStatus('âœ… è¯­éŸ³åŠŸèƒ½å·²å¼€å¯');
            } else {
                toggleBtn.textContent = 'ğŸ”‡';
                toggleBtn.style.background = '#95a5a6';
                showStatus('âŒ è¯­éŸ³åŠŸèƒ½å·²å…³é—­');
                stopAllSpeech();
            }
        }

        // åœæ­¢æ‰€æœ‰è¯­éŸ³
        function stopAllSpeech() {
            window.speechSynthesis.cancel();
            if (currentSpeaking) {
                currentSpeaking.classList.remove('speaking');
                currentSpeaking = null;
            }
            showStatus('â¹ï¸ å·²åœæ­¢è¯­éŸ³æ’­æ”¾');
        }

        // åˆ‡æ¢è®¾ç½®é¢æ¿
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('show');
        }

        // åŠ è½½å¯ç”¨è¯­éŸ³
        function loadVoices() {
            availableVoices = window.speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');

            // æ¸…ç©ºç°æœ‰é€‰é¡¹
            voiceSelect.innerHTML = '';

            // ç­›é€‰è‹±è¯­è¯­éŸ³å¹¶æŒ‰è´¨é‡æ’åº
            const englishVoices = availableVoices.filter(voice => voice.lang.startsWith('en'));

            // æŒ‰ä¼˜å…ˆçº§æ’åº
            const sortedVoices = englishVoices.sort((a, b) => {
                // Neural/Premium è¯­éŸ³ä¼˜å…ˆ
                if ((a.name.includes('Neural') || a.name.includes('Premium')) &&
                    !(b.name.includes('Neural') || b.name.includes('Premium'))) return -1;
                if (!(a.name.includes('Neural') || a.name.includes('Premium')) &&
                    (b.name.includes('Neural') || b.name.includes('Premium'))) return 1;

                // Google è¯­éŸ³ä¼˜å…ˆ
                if (a.name.includes('Google') && !b.name.includes('Google')) return -1;
                if (!a.name.includes('Google') && b.name.includes('Google')) return 1;

                // Microsoft è¯­éŸ³æ¬¡ä¹‹
                if (a.name.includes('Microsoft') && !b.name.includes('Microsoft')) return -1;
                if (!a.name.includes('Microsoft') && b.name.includes('Microsoft')) return 1;

                // æœ¬åœ°è¯­éŸ³ä¼˜å…ˆäºè¿œç¨‹è¯­éŸ³
                if (a.localService && !b.localService) return -1;
                if (!a.localService && b.localService) return 1;

                // ç¾å¼è‹±è¯­ä¼˜å…ˆ
                if (a.lang === 'en-US' && b.lang !== 'en-US') return -1;
                if (a.lang !== 'en-US' && b.lang === 'en-US') return 1;

                return a.name.localeCompare(b.name);
            });

            // æ·»åŠ è¯­éŸ³é€‰é¡¹
            sortedVoices.forEach((voice, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${voice.name} (${voice.lang})`;

                // æ ‡è®°æ¨èè¯­éŸ³
                if (voice.name.includes('Neural') || voice.name.includes('Premium') ||
                    voice.name.includes('Google') || voice.name.includes('Samantha') ||
                    voice.name.includes('Alex')) {
                    option.textContent += ' â­';
                }

                voiceSelect.appendChild(option);

                // è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªé«˜è´¨é‡è¯­éŸ³
                if (index === 0) {
                    selectedVoice = voice;
                    option.selected = true;
                }
            });
        }

        // æ›´æ–°è¯­éŸ³è®¾ç½®
        function updateVoiceSettings() {
            const voiceSelect = document.getElementById('voiceSelect');
            const selectedIndex = voiceSelect.value;

            if (selectedIndex !== '' && availableVoices[selectedIndex]) {
                selectedVoice = availableVoices[selectedIndex];
                showStatus(`âœ… å·²åˆ‡æ¢åˆ°: ${selectedVoice.name}`);
            }
        }

        // æ›´æ–°è¯­é€Ÿ
        function updateSpeechRate(value) {
            speechSettings.rate = parseFloat(value);
            document.getElementById('rateValue').textContent = value + 'x';
        }

        // æ›´æ–°éŸ³è°ƒ
        function updateSpeechPitch(value) {
            speechSettings.pitch = parseFloat(value);
            document.getElementById('pitchValue').textContent = value;
        }

        // æ›´æ–°éŸ³é‡
        function updateSpeechVolume(value) {
            speechSettings.volume = parseFloat(value);
            document.getElementById('volumeValue').textContent = Math.round(value * 100) + '%';
        }

        // å¿«é€Ÿæµ‹è¯•ç‰¹å®šå‚æ•°
        function quickTest(paramType) {
            if (!speechSupported || !speechEnabled) return;

            const testTexts = {
                rate: "Testing speech rate.",
                pitch: "Testing voice pitch.",
                volume: "Testing volume level.",
                default: "Quick test."
            };

            const text = testTexts[paramType] || testTexts.default;

            // åœæ­¢å½“å‰æ’­æ”¾
            window.speechSynthesis.cancel();

            // åˆ›å»ºè¯­éŸ³åˆæˆå®ä¾‹ï¼ˆä½¿ç”¨æœ€æ–°è®¾ç½®ï¼‰
            const utterance = createUtterance(text);

            // æ’­æ”¾è¯­éŸ³
            window.speechSynthesis.speak(utterance);
        }

        // æµ‹è¯•è¯­éŸ³
        function testSpeech() {
            if (!speechSupported || !speechEnabled) {
                showStatus('è¯­éŸ³åŠŸèƒ½ä¸å¯ç”¨');
                return;
            }

            const testTexts = [
                "Hello! This is a test of the optimized speech synthesis.",
                "Welcome to Singapore! Have a wonderful trip!",
                "The voice quality has been enhanced for natural pronunciation."
            ];

            const randomText = testTexts[Math.floor(Math.random() * testTexts.length)];

            // åœæ­¢å½“å‰æ’­æ”¾
            window.speechSynthesis.cancel();

            // åˆ›å»ºè¯­éŸ³åˆæˆå®ä¾‹ï¼ˆä½¿ç”¨æœ€æ–°è®¾ç½®ï¼‰
            const utterance = createUtterance(randomText);

            // äº‹ä»¶ç›‘å¬
            utterance.onstart = () => {
                showStatus(`ğŸµ æµ‹è¯•æ’­æ”¾: ${randomText}`);
            };

            utterance.onend = () => {
                showStatus('âœ… æµ‹è¯•å®Œæˆï¼ç°åœ¨ç‚¹å‡»è‹±æ–‡æ–‡æœ¬ä½“éªŒä¼˜åŒ–æ•ˆæœ');
            };

            utterance.onerror = (event) => {
                console.error('æµ‹è¯•è¯­éŸ³æ’­æ”¾é”™è¯¯:', event.error);
                showStatus('æµ‹è¯•è¯­éŸ³æ’­æ”¾å‡ºé”™ï¼Œè¯·é‡è¯•');
            };

            // æ’­æ”¾è¯­éŸ³
            window.speechSynthesis.speak(utterance);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            if (!speechSupported) {
                showStatus('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ï¼Œè¯·ä½¿ç”¨Chromeã€Safariæˆ–Edgeæµè§ˆå™¨', 5000);
                document.getElementById('speechToggle').classList.add('disabled');
                document.getElementById('stopBtn').classList.add('disabled');
                document.getElementById('settingsBtn').classList.add('disabled');
            } else {
                showStatus('ğŸµ è¯­éŸ³åŠŸèƒ½å·²ä¼˜åŒ–ï¼Œç‚¹å‡»è‹±æ–‡æ–‡æœ¬å³å¯æ’­æ”¾è‡ªç„¶è¯­éŸ³');

                // åŠ è½½è¯­éŸ³åˆ—è¡¨
                loadVoices();
                window.speechSynthesis.onvoiceschanged = loadVoices;

                // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­è®¾ç½®é¢æ¿
                document.addEventListener('click', function(event) {
                    const panel = document.getElementById('settingsPanel');
                    const settingsBtn = document.getElementById('settingsBtn');

                    if (!panel.contains(event.target) && event.target !== settingsBtn) {
                        panel.classList.remove('show');
                    }
                });
            }
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case 's':
                        event.preventDefault();
                        toggleSpeech();
                        break;
                    case 'x':
                        event.preventDefault();
                        stopAllSpeech();
                        break;
                }
            }
        });
    </script>
</body>
</html>
